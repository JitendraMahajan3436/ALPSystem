@model REIN_MES_System.Models.RS_OM_OrderRelease
@using REIN_MES_System.Models
<style>
    table {
        table-layout: fixed;
        width: 100px;
    }
</style>

@{
    ViewBag.Title = "Create";
    Layout = "~/Views/Shared/WithoutSideBarNoMenu/_Layout.cshtml";

    var globalData = (REIN_MES_System.Models.GlobalData)ViewData["GlobalDataModel"];
    REIN_SOLUTIONEntities db = new REIN_SOLUTIONEntities();
}
@if (ViewBag.flag == 1)
{
    <div class="box">
        <div class="box-header with-border">
            <div class="col-md-8">
                <div id="order-message-block" class="shop-notify order-start-notify"></div>
            </div>
            <div class="box-tools pull-right">
                @*<button class="btn btn-box-tool" data-widget="collapse" data-toggle="tooltip" title="Collapse"><i class="fa fa-minus"></i></button>
                    <button class="btn btn-box-tool" data-widget="remove" data-toggle="tooltip" title="Remove"><i class="fa fa-times"></i></button>*@
            </div>
        </div>
        <div class="box-body">
            <div>
                <div class="col-md-12 Order_Start">
                    <h4>
                        <b>Release Order List</b>
                    </h4>
                    <div class="col-md-12 plant-line">
                        <div class="form-horizontal">
                            @Html.ValidationSummary(true)
                            <div class="row">
                                <div class="">
                                    @using (Ajax.BeginForm("ShowStartOrderList", "OrderStart", new AjaxOptions()
                                    {
                                        HttpMethod = "POST",
                                        UpdateTargetId = "showStartedOrderDetail",
                                        InsertionMode = InsertionMode.Replace,
                                        OnBegin = "StartedOrdersLoadBegin",
                                        OnComplete = "StartedOrdersLoadComplete",
                                    }, new { @id = "showStartedOrderList" }))
                                    {
                                        <input type="hidden" id="startOrderListShopId" name="startOrderListShopId" value="@ViewBag.Shop_ID_User" />
                                        <input type="hidden" id="startOrderListLineId" name="startOrderListLineId" value="@ViewBag.Line_ID_User" />
                                    }

                                    <div id="showStartedOrderDetail">

                                    </div>
                                </div>
                            </div>

                            @*<h5> <b>Ready To Release Order List</b> </h5>*@
                            <div class="row">
                                @{
                                    if (ViewBag.Is_PPC_Kitting_Order != null)
                                    {

                                        if (ViewBag.Is_PPC_Kitting_Order)
                                        {
                                            @Html.Hidden("Is_PPC_Kitting_Order", (bool)ViewBag.Is_PPC_Kitting_Order)
                                            @*@Html.Action("ShowKitingOrderListByShopAndLine", "OrderStart")*@
                                            <div class="">
                                                @using (Ajax.BeginForm("PPCKittingOrderList", "OrderStart", new AjaxOptions()
                                                {
                                                    HttpMethod = "POST",
                                                    UpdateTargetId = "showReleasedOrderDetail",
                                                    InsertionMode = InsertionMode.Replace,
                                                    OnBegin = "ReleasedOrdersLoadBegin",
                                                    OnComplete = "ReleasedOrdersLoadComplete",
                                                }, new { @id = "showReleaseOrderList" }))
                                                {
                                                    <input type="hidden" id="orderListShopId" name="orderListShopId" value="@ViewBag.Shop_ID_User" />
                                                    <input type="hidden" id="orderListLineId" name="orderListLineId" value="@ViewBag.Line_ID_User" />
                                                }

                                                <div id="showReleasedOrderDetail">

                                                </div>
                                            </div>
                                        }
                                    }


                                    <div class="">
                                        @using (Ajax.BeginForm("ShowOrderListByShopAndLine", "OrderStart", new AjaxOptions()
                                        {
                                            HttpMethod = "POST",
                                            UpdateTargetId = "showReleasedOrderDetail",
                                            InsertionMode = InsertionMode.Replace,
                                            OnBegin = "ReleasedOrdersLoadBegin",
                                            OnComplete = "ReleasedOrdersLoadComplete",
                                        }, new { @id = "showReleaseOrderList" }))
                                        {
                                            <input type="hidden" id="orderListShopId" name="orderListShopId" value="@ViewBag.Shop_ID_User" />
                                            <input type="hidden" id="orderListLineId" name="orderListLineId" value="@ViewBag.Line_ID_User" />
                                        }

                                        <div id="showReleasedOrderDetail">

                                        </div>
                                    </div>
                                }


                            </div>


                            @{
                                if (ViewBag.Is_Spare != null)
                                {
                                    if (ViewBag.Is_Spare)
                                    {
                                        <h4>
                                            <b>Spare Order List</b>
                                        </h4>
                                        <div class="row">
                                            <div class="">
                                                @using (Ajax.BeginForm("SpareOrderList", "OrderStart", new AjaxOptions()
                                                {
                                                    HttpMethod = "POST",
                                                    UpdateTargetId = "showSpareOrderDetail",
                                                    InsertionMode = InsertionMode.Replace,
                                                    OnBegin = "SpareOrdersLoadBegin",
                                                    OnComplete = "SpareOrdersLoadComplete",
                                                }, new { @id = "showSpareOrderList" }))
                                                {
                                                    <input type="hidden" id="orderListShopId" name="orderListShopId" value="@ViewBag.Shop_ID_User" />
                                                    <input type="hidden" id="orderListLineId" name="orderListLineId" value="@ViewBag.Line_ID_User" />
                                                }

                                                <div id="showSpareOrderDetail">

                                                </div>
                                            </div>
                                        </div>
                                    }
                                }
                            }

                            <div class=" row">
                                <h4>
                                    <b>Serial Number</b>
                                </h4>
                                <div class="col-md-3 no-padding">
                                    @Html.TextBox("Serial_Number1", null, string.Empty, htmlAttributes: new { onchange = "", @class = "form-control" })
                                    @Html.ValidationMessage("Serial_Number1", null, new { @class = "validation_error" })
                                </div>
                                <div class="plant-line">

                                    <div class="col-md-4">
                                        <input type="button" id="btnStart_reprint" value="REPRINT" class="btn btn-primary" />
                                        @Ajax.ActionLink("SHOW RELEASE ORDER LIST", "loadAllReleasedOrders", "OrderStart", new AjaxOptions()
                                   {
                                       HttpMethod = "Get",
                                       UpdateTargetId = "releasedOrdersBody",
                                       InsertionMode = InsertionMode.Replace,
                                       OnBegin = "Loadingajax",
                                       OnComplete = "LoadingajaxComplete"
                                   }, new { @class = "btn btn-primary order_popup", id = "show_release" })
                                        @*<input type="button" id="show_release" value="SHOW RELEASE ORDER LIST" class="btn btn-primary order_popup" data-toggle="modal" data-target="#myModal" />*@
                                        <input type="button" id="btn_refresh" value="REFRESH" class="btn btn-warning" />
                                    </div>
                                    <div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    @*Show Order Release data*@

                    <div class="modal fade" id="myModal" role="dialog">
                        <div class="modal-dialog">
                            <!-- Modal content-->
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                                    <h4 class="modal-title">Release Order</h4>
                                </div>
                                <div class="modal-body">
                                    <div class="form-horizontal" id="releasedOrdersBody">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="supervisorLoginCred" style="display:none">


                    </div>
                    <button type="button" class="btn btn-primary order_Supervisor_cred" style="display:none;" data-toggle="modal" data-target="#myModal_SupervisorCred">Login</button>
                    <div class="modal fade" id="myModal_SupervisorCred" role="dialog">
                        <div class="modal-dialog" style="border: 4px solid dodgerblue;">
                            <div class="modal-content">
                                <div class="modal-body">
                                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                                    <div class="login-logo">
                                        <!-- <a href="../../index2.html"><b>Admin</b>LTE</a> -->
                                        <img src="/Content/images/ReinSolutionsLogo.jpeg" width="360" />
                                    </div>

                                    <div class="login-box-body">
                                        @*<p class="login-box-msg">Sign in to start your session</p>*@
                                        <div class="form-group has-feedback">
                                            <input type="email" id="txtTokenNumber" class="form-control" placeholder="Token Number">
                                            <span class="glyphicon glyphicon-envelope form-control-feedback"></span>
                                        </div>
                                        @*<div class="form-group has-feedback">
                                                <input type="password" class="form-control" placeholder="Password">
                                                <span class="glyphicon glyphicon-lock form-control-feedback"></span>
                                            </div>*@
                                        <div class="row">
                                            <div class="col-xs-4">
                                                <button type="button" id="validTokenNumber" class="btn btn-primary btn-block btn-flat">Sign In</button>
                                            </div><!-- /.col -->
                                        </div>
                                        <br />
                                        <div>
                                            <label id="lblInvalidTokenNumner" style="color:red"></label>
                                        </div>

                                        <!--<div class="social-auth-links text-center">
                                          <p>- OR -</p>
                                          <a href="#" class="btn btn-block btn-social btn-facebook btn-flat"><i class="fa fa-facebook"></i> Sign in using Facebook</a>
                                          <a href="#" class="btn btn-block btn-social btn-google-plus btn-flat"><i class="fa fa-google-plus"></i> Sign in using Google+</a>
                                        </div> -->
                                        <!-- /.social-auth-links -->
                                        @*<a href="#">I forgot my password</a><br>
                                            <a href="register.html" class="text-center">Register a new membership</a>*@

                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    @*kitting popup*@
                    <button type="button" class="btn btn-primary order_kit_popup" style="display:none;" data-toggle="modal" data-target="#myModal_kit">Add Order</button>
                    <input type="hidden" id="row_id_kit" />
                    <input type="hidden" id="row_id_orderNo" />
                    <div class="modal fade" id="myModal_kit" role="dialog">
                        <div class="modal-dialog">
                            <!-- Modal content-->
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                                    <h4 class="modal-title">Kitting </h4>
                                </div>
                                <p id="error_msgParts" style="color:red;font-size:15px;"></p>
                                <div class="modal-body">
                                    @*changes*@

                                    <div class="form-horizontal">
                                        <div class="row">
                                            <div id="kitting_part" class="shopForm-wrapper">

                                                <div class="col-sm-5">
                                                    KITTING BARCODE.
                                                </div>
                                                <div class="col-sm-6">
                                                    <input type="text" id="txt_Kitting" class="validate_kitt_serial_no form-control" />
                                                    <p id="error_msg" style="color:red;font-size:15px;"></p>
                                                </div>

                                            </div>
                                            @*added for Part Configuration --ketan*@
                                            <div class="row">
                                                <div class="modelCheckboxList col-xs-4" style="float: right;">
                                                    @*   <label for="SelectAll" style="background-color: lightgoldenrodyellow;width:13rem">Part Number</label>*@
                                                    <input type="checkbox" id="SelectAll" name="ModelCodes" value="Select All" />
                                                    <label for="SelectAll" style="width:13rem">Select All</label>
                                                </div>
                                                @*<div class="modelCheckboxList col-xs-2">
                                                        <label style="background-color: lightgoldenrodyellow;width:9.2rem">Quantity</label>
                                                    </div>
                                                    <div class="modelCheckboxList col-xs-4">
                                                        <label style="background-color: lightgoldenrodyellow;">Kitting Zone Name</label>
                                                    </div>*@
                                            </div>
                                            <div class="part_html">

                                            </div>

                                        </div>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-default pull-left" data-dismiss="modal">Close</button>
                                    <input type="submit" value="Save" id="SavePartNumbers" class="btn btn-primary" />
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="loading_global_spinner_image" style="display:none;">
                        @*<img src="~/Content/images/loader2.GIF" />*@
                        <img src="~/Content/images/gears.gif" />
                    </div>
                </div>
                @section Scripts {
                    @Scripts.Render("~/bundles/jqueryval")
                    @Scripts.Render("~/Content/theme/plugins/datatables/js")
                    @Styles.Render("~/Content/theme/plugins/datatables/css")
                    @Scripts.Render("~/Scripts/user_datatable")
                    @Styles.Render("~/fdtheme/spinner_css")
                    @Scripts.Render("~/fdtheme/spinner_js")

                    <script src="~/Scripts/jquery.validate.min.js"></script>
                    <script src="~/Scripts/jquery.validate.unobtrusive.min.js"></script>
                    <script src="~/Scripts/jquery.unobtrusive-ajax.min.js"></script>
                    <script type="text/javascript">
                        //to chceck is kitting available while submitting ---- ketan
                        var IsKittingAvailable = '';
                        var Model_Code = '';
                        var OrderID = '';

                        function StartedOrdersLoadBegin() {
                            $("#showStartedOrderDetail").html("<img class='loading-img' src='@(Url.Content("/Content/images/loader2.GIF"))'/>");
                        }
                        function StartedOrdersLoadComplete() {
                        }
                        function ReleasedOrdersLoadBegin() {
                            $("#showReleasedOrderDetail").html("<img class='loading-img' src='@(Url.Content("/Content/images/loader2.GIF"))'/>");
                        }
                        function ReleasedOrdersLoadComplete() {
                        }
                        function SpareOrdersLoadBegin() {
                            $("#showSpareOrderDetail").html("<img class='loading-img' src='@(Url.Content("/Content/images/loader2.GIF"))'/>");
                        }
                        function SpareOrdersLoadComplete() {
                        }
                        function Loadingajax() {
                            $('#myModal').modal();
                            $("#releasedOrdersBody").html("<img class='loading-img' src='@(Url.Content("/Content/images/loader2.GIF"))'/>");
                        }
                        //setInterval(function () {
                        //    $(".start_orders").click();
                        //}, 5000);

                        $(document).ready(function () {
                            $("#btn_refresh").click(function (e) {
                                loadShopOrderList();
                                loadShopStartedList();
                                loadSpareOrderList();

                            });
                            //sandip
                            $("#showReleasedOrderDetail").on("click", ".start_orders", function (e) {
                                var rowOrdeType = $(this).data("orderType");
                                var rowId = $(this).data("order-rowid");
                                var srno = $(this).data("orderno");
                                $('#row_id_kit').val(rowId);
                                $('#row_id_orderNo').val(srno);
                                var orderType = rowOrdeType.trim();
                                if (rowOrdeType.trim().length > 0) {
                                    $.getJSON("/OrderStart/IsAuthorizeBySupervisor", { orderType: orderType }, function (result) {
                                        if (result != null) {
                                            if (result.status == true) {
                                                $('#lblInvalidTokenNumner').text('');
                                                $(".order_Supervisor_cred").trigger("click");
                                            }
                                            else {
                                                //var rowId = $(this).data("order-rowid");
                                                $('#row_id_kit').val(rowId);
                                                order_Start();
                                            }
                                        }
                                    });
                                }
                                //else if ($('#hdnIsKitting').val() == "1") {
                                //    var rowId = $(this).data("order-rowid");
                                //    $('#row_id_kit').val(rowId);
                                //    // alert($('#row_id_kit').val());
                                //    $(".order_kit_popup").trigger("click");
                                //    //row_id_kit

                                //    //to Show part configure in bom item and Kiiting zone ---Ketan
                                //    var tr = $(this).parent().parent().find('td');
                                //    var ModelCode = tr[1].innerText;
                                //    Model_Code = tr[1].innerText;
                                //    OrderID = tr[0].innerText;
                                //    if (ModelCode != null) {
                                //        $.getJSON("/OrderStart/GetPartConfiguredInBOMItemAndKittingZone", { ModelCode: ModelCode }, function (data) {
                                //            if (data != null) {
                                //                if (data.length > 0) {
                                //                    //$('#ModalPart').modal('show');
                                //                    $('#error_msgParts').html('');
                                //                    var res = "";
                                //                    res = '<div class="modelCheckboxList_q col-xs-8">';
                                //                    res = res + '<label for="Part_No" style="background-color: lightgoldenrodyellow">Part Number</label></div>'
                                //                    res = res + '<div class="modelCheckboxList_q col-xs-4"><label style="background-color: lightgoldenrodyellow;">Quantity</label></div>'
                                //                    //res = res + '<div class="modelCheckboxList col-xs-4"><label style="background-color: lightgoldenrodyellow;">Kitting Zone Name</label></div>'
                                //                    for (var i = 0; i < data.length; i++) {
                                //                        res = res + '<div class="modelCheckboxList col-xs-8 partNoDiv"><input type="checkbox" id="' + data[i].Part_No + '" name="ModelCodes" value="' + data[i].Part_No + '" title="' + data[i].Quantity + '"/><label for="' + data[i].Part_No + '">' + data[i].Part_No + '</label></div>';
                                //                        res = res + '<div class="modelCheckboxList_q col-xs-4"><label for="' + data[i].Quantity + '">' + data[i].Quantity + '</label></div>';
                                //                        //res = res + '<div class="modelCheckboxList col-xs-4"><label for="' + data[i].kittingZoneName + '">' + data[i].kittingZoneName + '</label></div>';

                                //                    }
                                //                    //res = res + '</div>'
                                //                    $(".part_html").html(res);
                                //                    $(".loading_global_spinner_image").hide();
                                //                    SelectAllPartNo();
                                //                    document.getElementById("SelectAll").checked = true;

                                //                }
                                //                else {
                                //                    $('#error_msgParts').html('No Parts Available in BOM Item or In Kitting Part Zone!...');
                                //                }
                                //            }
                                //            else {
                                //                $(".loading_global_spinner_image").hide();
                                //                $('#error_msgParts').html('No Parts Available in BOM Item or In Kitting Part Zone!...');
                                //                //$("#message-block").addClass('bg-error');
                                //                //alert("Line is Stop Order is Not Started !");
                                //            }

                                //        }).fail(function (jqXHR, textStatus, errorThrown) {
                                //            location.reload();
                                //        });
                                //    }
                                //}
                                //else {

                                //}
                            });


                            //Reprint Serial Number
                            $("#btnStart_reprint").click(function (e) {
                                var serial_number = document.getElementById("Serial_Number1").value;
                                if (serial_number) {
                                    var url = "/OrderStart/isReprint";
                                    //ajaxpack.getAjaxRequest(url, "serial_number=" + serial_number + "&Shop_Id=" + shopId, isreprintOrderStart, "json");
                                    $.getJSON(url, { serial_number: serial_number }, function (data) {

                                        if (data == true) {
                                            document.getElementById("Serial_Number1").value = "";
                                            document.getElementById("Serial_Number1").focus();
                                        }
                                        else {
                                            $('#order-message-block').html("Invalid Serial Number Please Check Serial Number.....!");
                                            $('#order-message-block').addClass('bg-error').removeClass('bg-correct');
                                            $("html, body").animate({ scrollTop: 0 }, "slow");

                                            document.getElementById("Serial_Number1").value = "";
                                            document.getElementById("Serial_Number1").focus();
                                        }
                                    }).fail(function (jqXHR, textStatus, errorThrown) {
                                        location.reload();
                                    });
                                }
                                else {
                                    $('#order-message-block').html("Please Enter Serial Number.....!");
                                    $('#order-message-block').addClass('bg-error').removeClass('bg-correct');
                                    $("html, body").animate({ scrollTop: 0 }, "slow");
                                    $(".loading_global_spinner_image").hide();
                                }
                            });

                            $("#showReleasedOrderDetail").on("click", ".hold_orders", function (e) {
                                //alert($(this).attr("id"));
                                var rowid = $(this).data("order-rowid");
                                var url = "/ManageOrders/changeOrderStateLinewise";

                                $.getJSON(url, { status: "Hold", rowID: rowid }, function (data) {
                                    if (data != null) {
                                        if (data == true) {
                                            loadShopOrderList();
                                            $('#order-message-block').html("Order holded Successfully.....!");
                                            $('#order-message-block').addClass('bg-correct').removeClass('bg-error');
                                            $("html, body").animate({ scrollTop: 0 }, "slow");
                                        }
                                        else {
                                            $('#order-message-block').html("Order hold Not allowed.....!");
                                            $('#order-message-block').addClass('bg-error').removeClass('bg-correct');
                                            $("html, body").animate({ scrollTop: 0 }, "slow");
                                        }
                                    }
                                }).fail(function (jqXHR, textStatus, errorThrown) {
                                    location.reload();
                                });
                            });

                            $('#order_start').dataTable();

                            setTimeout(function (e) {
                                //getTopOrderDetail();
                                loadShopOrderList();
                                loadShopStartedList();
                                loadSpareOrderList();
                            }, 500);

                        });// DOCUMENT READY STATE END


                        function loadShopOrderList() {
                            $("#showReleaseOrderList").submit();
                        }

                        function loadShopStartedList() {
                            $("#showStartedOrderList").submit();
                        }

                        function loadSpareOrderList() {
                            $("#showSpareOrderList").submit();
                        }
                        //-----------------------------------------------------------------//

                        function order_Start() {
                            var kitting_Barcode = $('#txt_Kitting').val();
                            var rowId = $('#row_id_kit').val();
                            var serialNo = $('#row_id_orderNo').val();
                            if (rowId) {
                                var url = "/OrderStart/StartOrder";
                                debugger;
                                $(".loading_global_spinner_image").show();
                                //ajaxpack.getAjaxRequest(url, "rowId=" + rowId + "&plantId=" + plantId + "&shopId=" + shopId + "&lineId=" + lineId + "&stationId=" + stationId + "&orderno=" + orderNo + "&modelcode=" + modelCode + "&rsn=" + RSN, showOrderStartDetail, "json");
                                $.getJSON(url, { rowId: rowId, kitting_Barcode: kitting_Barcode }, function (data) {
                                    
                                    if (data != null) {
                                        if (data.status == true) {
                                            // added by ketan to save part order details    Date 12-jun-17
                                            if (IsKittingAvailable == true) {
                                                SavePartsOrderDetails();
                                            }
                                            $('#order-message-block').html("Order is Started.....!");
                                            $('#order-message-block').addClass('bg-correct').removeClass('bg-error');
                                            $("html, body").animate({ scrollTop: 0 }, "slow");
                                            $(".loading_global_spinner_image").hide();
                                            $('#error_msg').html('');
                                            $('#txt_Kitting').val('');
                                            closepopup();
                                            printBuildSheet(serialNo);
                                        }
                                        else {
                                            if (data.message != null && data.message != "") {
                                                $('#order-message-block').html(data.message);
                                            }
                                            else {
                                                $('#order-message-block').html(data.kit_message);
                                            }
                                            $('#error_msg').html(data.kit_message);
                                            $('#order-message-block').addClass('bg-error').removeClass('bg-correct');
                                            $("html, body").animate({ scrollTop: 0 }, "slow");
                                            $(".loading_global_spinner_image").hide();
                                            //$("#message-block").addClass('bg-error');
                                            //alert("Line is Stop Order is Not Started !");
                                        }
                                        //getTopOrderDetail();
                                        loadShopOrderList();
                                        loadShopStartedList();
                                        loadSpareOrderList();
                                    } else {
                                        $(".loading_global_spinner_image").hide();
                                        //$("#message-block").addClass('bg-error');
                                        //alert("Line is Stop Order is Not Started !");
                                    }

                                }).fail(function (jqXHR, textStatus, errorThrown) {
                                    location.reload();
                                });
                            }
                            else {
                                $('#order-message-block').html("No orders are available to start.....!");
                                $('#order-message-block').addClass('bg-error').removeClass('bg-correct');
                                $("html, body").animate({ scrollTop: 0 }, "slow");
                            }
                            //Checking supervisor login credential

                        }
                        function printBuildSheet(order_No)
                        {
                            debugger;
                            if (order_No) {
                                var url = "/OrderStart/BuildSheetPrint";
                                //ajaxpack.getAjaxRequest(url, "rowId=" + rowId + "&plantId=" + plantId + "&shopId=" + shopId + "&lineId=" + lineId + "&stationId=" + stationId + "&orderno=" + orderNo + "&modelcode=" + modelCode + "&rsn=" + RSN, showOrderStartDetail, "json");
                                $.getJSON(url, { order_No: order_No}, function (data) {
                                    if (data != null) {

                                        var req = new XMLHttpRequest();
                                        req.open("GET", "App_Data/buildSheet.pdf", true);
                                        req.responseType = "blob";

                                        req.onload = function (event) {
                                            //var blob = req.response;
                                            //console.log(blob.size);
                                            //var link = document.createElement('a');
                                            //link.href = window.URL.createObjectURL(blob);
                                            //debugger;
                                            ////link.download = data.msg;
                                            //link.download = data.msg;
                                            //debugger;
                                            //link.click();
                                            //debugger;


                                            //added by mukesh
                                            var blob = req.response;
                                            debugger;
                                            //var downloadUrl = URL.createObjectURL(data.msg);
                                            var a = document.createElement("a");
                                            //a.href = data.msg;
                                            a.href = '/OrderStart/DownloadBuildSheet?fileName=' + data.msg;
                                            a.download = data.fileName;
                                            //'/OrderStart/BuildSheetPrint?fileName=' + data.msg
                                            
                                            //document.body.appendChild(a);
                                            a.click();
                                            ///
                                           
                                        };
                                        //window.location.href = data.msg;
                                        req.send();
                                        debugger;
                                    } else {
                                        $(".loading_global_spinner_image").hide();
                                        //$("#message-block").addClass('bg-error');
                                        //alert("Line is Stop Order is Not Started !");
                                    }

                                }).fail(function (jqXHR, textStatus, errorThrown) {
                                    location.reload();
                                });
                            }
                        }
                        $("#txt_Kitting").keydown(function () {

                            if (event.keyCode === 13) {
                                var kitting_Serialno = $("#txt_Kitting").val();
                                if (kitting_Serialno.length > 5) {
                                    //IsKitAvailabele
                                    var url = "/OrderStart/IsKitAvailabele";
                                    $.getJSON(url, { kitting_Barcode: kitting_Serialno }, function (data) {
                                        if (data != null) {

                                            if (data.msg == true) {
                                                IsKittingAvailable = data.msg;  //--ketan
                                                $('#error_msg').html('');
                                                $('#SavePartNumbers').attr('disabled', false);
                                                //closepopup();
                                                //order_Start();--- comment by ketan due to add in parts order details..
                                            }
                                            else {
                                                IsKittingAvailable = data.msg; //--ketan
                                                $('#error_msg').html(data.msg);
                                                $('#SavePartNumbers').attr('disabled', true);
                                                return false;
                                            }
                                        }
                                    });

                                }
                                else {
                                    $('#SavePartNumbers').attr('disabled', true);
                                    $('#error_msg').html('Invalid Kit BarCode');
                                    return false;
                                }

                            }
                        });

                        function closepopup() {
                            $("#myModal_kit .close").trigger("click");
                        }

                        //-----------------------------Kitting parts Code No use in Nashik-----------------------------//
                        $('#SelectAll').on("click", function () {
                            var PartNoCheckbox = $('.part_html').children().find('input')
                            var checked = document.getElementById("SelectAll").checked
                            if (checked) {
                                if (PartNoCheckbox.length > 0) {
                                    for (var i = 0; i < PartNoCheckbox.length; i++) {
                                        PartNoCheckbox[i].checked = true;
                                        $('#SavePartNumbers').removeClass('disabled');
                                    }
                                }
                            }
                            else {
                                if (PartNoCheckbox.length > 0) {
                                    for (var i = 0; i < PartNoCheckbox.length; i++) {
                                        PartNoCheckbox[i].checked = false;
                                        $('#SavePartNumbers').addClass('disabled', 'disabled');
                                    }
                                }
                            }
                        });
                        //if all part No are checked than select All also checked--------------//
                        $(document).on('click', '.partNoDiv', function () {

                            var PartNoCheckbox = $('.part_html').children().find('input')
                            if (PartNoCheckbox.length > 0) {
                                for (var i = 0; i < PartNoCheckbox.length; i++) {
                                    if (PartNoCheckbox[i].checked == true) {
                                        document.getElementById("SelectAll").checked = true;
                                        $('#SavePartNumbers').removeClass('disabled');
                                    }
                                    else {
                                        document.getElementById("SelectAll").checked = false;
                                        $('#SavePartNumbers').addClass('disabled', 'disabled');
                                        break;
                                    }
                                }
                            }
                        });

                        $(document).on('click', '#SavePartNumbers', function () {

                            if (IsKittingAvailable == true) {
                                $('#error_msg').html('');
                                order_Start();
                            }
                            else {
                                $('#txt_Kitting').focus();
                                $('#error_msg').html('Scan kitting Barcode');
                            }
                        });
                        function SelectAllPartNo() {
                            var PartNoCheckbox = $('.part_html').children().find('input')
                            if (PartNoCheckbox.length > 0) {
                                for (var i = 0; i < PartNoCheckbox.length; i++) {
                                    PartNoCheckbox[i].checked = true;
                                }
                            }

                        }
                        //to save order part details                ---ketan Date12-jum-17
                        function SavePartsOrderDetails() {
                            if (IsKittingAvailable) {
                                var PartNoCheckbox = $('.part_html').children().find('input')
                                var dataModal = []
                                if (PartNoCheckbox.length > 0) {
                                    var kitting_Barcode = $('#txt_Kitting').val();
                                    for (var i = 0; i < PartNoCheckbox.length; i++) {
                                        if (PartNoCheckbox[i].checked == true) {

                                            dataModal.push({
                                                Part_No: PartNoCheckbox[i].value,
                                                Quantity: PartNoCheckbox[i].title
                                            });
                                        }
                                    }
                                    //JSON.stringify(dataModal);
                                    $.getJSON("/OrderStart/SaveOrderPartsDetails", { dataModel: JSON.stringify(dataModal), barcodeString: kitting_Barcode, Model_Code: Model_Code, OrderID: OrderID }, function (data) {
                                        if (data != null) {
                                            if (data.length > 0) {
                                                //$('#ModalPart').modal('show');

                                                $(".loading_global_spinner_image").hide();
                                            }
                                        }
                                        else {
                                            $(".loading_global_spinner_image").hide();
                                            //$("#message-block").addClass('bg-error');
                                            //alert("Line is Stop Order is Not Started !");
                                        }

                                    }).fail(function (jqXHR, textStatus, errorThrown) {
                                        location.reload();
                                    });
                                }
                            }

                        }
                        //-------------------------------End-----------------------------------//

                        //--------------------Added Code for Nashik Developement-----Ketan------------------------------//
                        $("#txtTokenNumber").keydown(function () {

                            if (event.keyCode === 13) {

                                IsValidTokenNumber();
                            }
                        });
                        function IsValidTokenNumber() {

                            var tokenNumber = $("#txtTokenNumber").val();
                            if (tokenNumber.length > 0) {
                                //IsKitAvailabele
                                var url = "/OrderStart/IsValidTokenNumber";
                                $.getJSON(url, { TokenNumber: tokenNumber }, function (data) {
                                    if (data != null) {

                                        if (data.status == true) {
                                            $('#lblInvalidTokenNumner').text(data.msg);
                                            $("#myModal_SupervisorCred .close").trigger("click");
                                            order_Start();
                                        }
                                        else {
                                            $('#lblInvalidTokenNumner').text(data.msg);
                                            return false;
                                        }
                                    }
                                });

                            }
                            else {
                                $('#lblInvalidTokenNumner').html('Please Enter Token Number');
                                return false;
                            }
                        }
                        $("#showSpareOrderDetail").on("click", ".start_orders", function (e) {
                            var rowOrdeType = $(this).data("orderType");
                            var rowId = $(this).data("order-rowid");
                            $('#row_id_kit').val(rowId);
                            var orderType = "Spare";
                            if (rowOrdeType.trim().toLowerCase() == orderType.toLowerCase()) {
                                if (rowId) {
                                    var url = "/OrderStart/StartSpareOrder";
                                    $(".loading_global_spinner_image").show();
                                    //ajaxpack.getAjaxRequest(url, "rowId=" + rowId + "&plantId=" + plantId + "&shopId=" + shopId + "&lineId=" + lineId + "&stationId=" + stationId + "&orderno=" + orderNo + "&modelcode=" + modelCode + "&rsn=" + RSN, showOrderStartDetail, "json");
                                    $.getJSON(url, { rowId: rowId }, function (data) {
                                        if (data != null) {
                                            if (data.status == true) {
                                                $('#order-message-block').html("Order is Started.....!");
                                                $('#order-message-block').addClass('bg-correct').removeClass('bg-error');
                                                $("html, body").animate({ scrollTop: 0 }, "slow");
                                                $(".loading_global_spinner_image").hide();
                                                $('#error_msg').html('');
                                            }
                                            else {
                                                if (data.message != null && data.message != "") {
                                                    $('#order-message-block').html(data.message);
                                                }
                                                else {
                                                    $('#order-message-block').html(data.kit_message);
                                                }
                                                $('#error_msg').html(data.kit_message);
                                                $('#order-message-block').addClass('bg-error').removeClass('bg-correct');
                                                $("html, body").animate({ scrollTop: 0 }, "slow");
                                                $(".loading_global_spinner_image").hide();
                                            }
                                            loadShopOrderList();
                                            loadShopStartedList();
                                            loadSpareOrderList();
                                        } else {
                                            $(".loading_global_spinner_image").hide();
                                            //$("#message-block").addClass('bg-error');
                                            //alert("Line is Stop Order is Not Started !");
                                        }
                                    }).fail(function (jqXHR, textStatus, errorThrown) {
                                        location.reload();
                                    });
                                }
                                else {
                                    $('#order-message-block').html("No orders are available to start.....!");
                                    $('#order-message-block').addClass('bg-error').removeClass('bg-correct');
                                    $("html, body").animate({ scrollTop: 0 }, "slow");
                                }
                            }
                        });

                        $("#validTokenNumber").click(function (e) {
                            IsValidTokenNumber();
                        });
                        //------------------------------------End----------------------------------------------------//
                    </script>
                }
            </div>
        </div><!-- /.box-body -->
        <br />
        <br />
    </div><!-- /.box -->
                                }
                                else
                                {
                                    string mName = TempData["MachineName"].ToString();
                                    string[] split = mName.Split(',');
                                    for (int i = 0; i < split.Length - 1; i++)
                                    {
                                        <div class="row">

                                            <div class="col-lg-12" style="padding-left:20px;padding-right:20px;">
                                                <div class="alert alert-danger fade in">
                                                    @*<a href="#" class="close" data-dismiss="alert">&times;</a>*@
                                                    <strong>Error!</strong> @split[i].ToString() machine clita not done
                                                </div>
                                            </div>
                                        </div>
                                    }

                                }
